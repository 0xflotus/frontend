checkout:
  post:
    - git submodule update --init resources/public/vendor/font-awesome

dependencies:

  cache_directories:
    - "~/.cache/bower"

  post:
    - node_modules/bower/bin/bower install || (sleep 2; node_modules/bower/bin/bower install)
    - "[[ -d resources/components ]] || node_modules/bower/bin/bower install"

deployment:
  deploy:
    branch: /.+/
    commands:
      - lein cljsbuild once test production:
          timeout: 600
      - lein run -m frontend.tasks.http/precompile-assets
      - script/deploy.sh
