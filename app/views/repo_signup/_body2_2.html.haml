%h4
  Add projects to Circle

= form_tag(add_repo_form_url, :method => :post, :remote => true) do |f|
  = label_tag :public, "show public"
  = check_box_tag("public")
  %br
  = label_tag :forks, "show forks"
  = check_box_tag("fork")
  
  %table#projects
    %thead
      %tr
        %th Project
        %th Description
        %th Language
        %th Fork?
        %th Public?
        %th Add?
    %tbody
      - @result.sort_by{|a| DateTime.parse(a[:pushed_at])}.reverse.each do |project|
        - recent = ((DateTime.parse(project[:pushed_at]) > 3.months.ago) and (project[:private]) and (not project[:fork]))
        %tr
          %td
            - name = "#{project[:owner][:login]}/#{project[:name]}"
            = name
          %td
            = project[:description]
          %td
            = project[:language]
          %td
            = project[:fork]
          %td
            = not project[:private]
          %td
            = check_box_tag name, "add_project", recent

  = submit_tag("Add projects")

-# TECHNICAL_DEBT make this coffeescript
:javascript
  var project_table;
  $(document).ready(function() {
    show_forks = function () { project_table.fnFilter(".*", 3, true);};
    hide_forks = function () { project_table.fnFilter("false", 3, true);};

    show_public = function () { project_table.fnFilter(".*", 4, true);};
    hide_public = function () { project_table.fnFilter("false", 4, true);};

    project_table = $('#projects').dataTable({
      "bPaginate": false,
      "bSort": false,
      "bInfo": false,
      "oLanguage": {"sSearch": "",
                    "sEmptyTable": "No projects found",
                     "sZeroRecords": "No projects match your filters"},
      "aoColumnDefs": [{"bVisible": false, "aTargets": [3, 4]}]
     });
    $('#fork').change(function() {
      if ($('#fork').is(':checked'))
      {
        show_forks();
      }
      else
      {
        hide_forks();
      }
    });

    $('#fork').prop("checked", false);
    hide_forks();

    $('#public').change(function() {
      if ($('#public').is(':checked'))
      {
        show_public();
      }
      else
      {
        hide_public();
      }
    });
    $('#public').prop("checked", false);
    hide_public();
  })
