poller = () ->
  $.getJSON("/add-repo/dynamic",
    (data, textStatus) ->
      if data["ready"]
        adjust_page(data["step"], data["body"], data["explanation"])
      if data["keep_polling"]
        setTimeout(poller, 200)
  )

adjust_page = (step, body, explanation) ->
  for i in [1,2,3]
    if i == step
      if body
        node = $("#body#{i} > .contents")
        node.empty()
        node.append(body)
      if explanation
        node = $("#explanation#{i} > .contents")
        node.empty()
        node.append(explanation)
      $("#header#{i}").removeClass("subdued")
      $("#header#{i}").addClass("highlighted")
      $("#body#{i}").removeClass("hidden")
      $("#explanation#{i}").removeClass("hidden")
    else
      $("#header#{i}").removeClass("highlighted")
      $("#header#{i}").addClass("subdued")
      $("#body#{i}").addClass("hidden")
      $("#explanation#{i}").addClass("hidden")

$(document).ready ->
  setTimeout(poller, 200)
