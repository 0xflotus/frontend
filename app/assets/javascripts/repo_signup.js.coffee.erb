poller = (retry) ->
  $.getJSON("/add-repo/dynamic",
    (data, textStatus) ->
      ready = data["ready"]
      alert data["state"]
      if ready? # otherwise nothing is being fetched
        if ready
          adjust_page(data["step"], data["substep"], data["rendering"])
        else
          # Result just isn't ready yet, but it's coming
          retry()
  )

adjust_page = (step, substep, rendering) ->
  alert("adjusting")
  alert(substep)
  alert(step)
  alert(rendering)

$(document).ready ->
  $.smartPoller(10, poller)
