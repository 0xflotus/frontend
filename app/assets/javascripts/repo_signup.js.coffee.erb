poller = () ->
  $.getJSON("/add-repo/dynamic",
    (data, textStatus) ->
      ready = data["ready"]
      if ready?
        if ready
          adjust_page(data["step"], data["rendering"])
        setTimeout(poller, 200)
  )

adjust_page = (step, rendering) ->
  for i in [1,2,3]
    if i == step
      $('#header' + i).removeClass("subdued")
      $('#header' + i).addClass("highlighted")
      $('#body' + i).removeClass("hidden")
      $('#explanation' + i).removeClass("hidden")
    else
      $('#header' + i).removeClass("highlighted")
      $('#header' + i).addClass("subdued")
      $('#body' + i).addClass("hidden")
      $('#explanation' + i).addClass("hidden")

$(document).ready ->
  setTimeout(poller, 200)
