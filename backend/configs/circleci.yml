build:
  type: build
  node: www   # name of node to use. unique per-project
  commands:
    - lein deps:
        pwd: backend
    - lein midje:
        pwd: backend
        environment:
          CIRCLE_ENV: "staging"
  on-success: deploy # another build to trigger if this one is successful
  notify-email:   # list of people to email about build results. Recognized keys, :committer, :owner, or email literals.
    - :committer
    - :owner

deploy:
  type: deploy

  commands:
    - lein deps:
        pwd: backend
    - lein daemon start ":web":
        pwd: backend
        environment:
          CIRCLE_ENV: "production"
          SWANK: "true"
    - sudo /etc/init.d/nginx start
